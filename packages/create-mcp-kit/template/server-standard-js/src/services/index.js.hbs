import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js'
import { registerTools } from '../tools/index.js'
import { registerResources } from '../resources/index.js'
import { registerPrompts } from '../prompts/index.js'
{{#if (includes transports 'stdio')}}
import { stdioServer } from './stdio.js'
{{/if}}
{{#if (or (includes transports 'streamable') (includes transports 'sse'))}}
import { webServer } from './web.js'
{{/if}}

const createServer = options => {
  const server = new McpServer({
    name: options.name,
    version: options.version,
  })
  registerTools(server, options)
  registerResources(server, options)
  registerPrompts(server)
  return server
}
{{#if (includes transports 'stdio')}}

export async function startStdioServer(options) {
  const server = createServer(options)
  await stdioServer(server)
}
{{/if}}
{{#if (or (includes transports 'streamable') (includes transports 'sse'))}}

export async function startWebServer(options) {
  const server = createServer(options)
  await webServer(server, options)
}
{{/if}}
